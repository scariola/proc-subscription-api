<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
	
	<sub-flow name="common-get-spiel-subflow" doc:id="a475d027-9214-4f36-b297-81f6b204da64">
  <ee:transform doc:name="Resolve SMS Spiel">
    <ee:message />
    <ee:variables>
      <ee:set-variable variableName="smsSpielMapping"><![CDATA[%dw 2.0
output application/json


fun getSpiel(map, keyword, brand, spielType) =
  map[keyword][brand][spielType] 
    default map["ANY"]["ANY"]["system-error"]

var spielMap = readUrl("classpath://dw/mapping-payload-sms-spiels.dwl", "application/json")

---
{
  "sms-spiel": getSpiel(
    spielMap,
    vars.formattedSubscriberData.keyword default "ANY",
    vars.brand.'brand-name' default "ANY",
    vars.spielType default "system-error"
  )
}
]]></ee:set-variable>
    </ee:variables>
  </ee:transform>
</sub-flow>
	
	
</mule>
