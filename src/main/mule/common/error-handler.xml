<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<error-handler
		name="proc-subscription-api-Shared_Error_Handler"
		doc:id="ce502ca3-fef7-49aa-b16a-0eafa6daa05f">
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="31c28ae5-0b29-4149-816e-adb539aea003" type="HTTP:BAD_REQUEST">
			<flow-ref doc:name="common-set-error-audit-log-subflow" doc:id="7322a817-d410-4b70-a331-76d8d4509842" name="common-set-error-audit-log-subflow" />
			<flow-ref doc:name="impl-subscription-put-audit-subflow" doc:id="03f00fdd-d99b-46c7-adf1-9dd7659d22a3" name="impl-subscription-put-audit-subflow" />
			<flow-ref doc:name="impl-subscription-post-sms-subflow" doc:id="a9d3eb95-0d1c-433b-8361-eb02b2b68eac" name="impl-subscription-post-sms-subflow" />
			<ee:transform doc:name="Set Payload - http bad request" doc:id="dab8d964-a2e7-4415-9cde-71266c365368">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "x-event-code": correlationId,	
  "x-event-code": 9204,
  "x-event-msg": "Bad Request - Invalid Parameter or Request",
  "result": {
    "error-type": error.errorType.namespace ++ ":" ++ error.errorType.identifier,
    "error-description": error.detailedDescription
  }
}
]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<set-variable value="400" doc:name="httpStatus" doc:id="c7758acb-7a89-449e-a96e-dd326b8906d3" variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="90a4686e-0e9f-46de-9887-2d1cbcbadf43" type="HTTP:CONNECTIVITY">
			<flow-ref doc:name="common-set-error-audit-log-subflow" doc:id="ffb7f398-edb8-4e25-a779-1dc78f43666e" name="common-set-error-audit-log-subflow" />
			<flow-ref doc:name="impl-subscription-put-audit-subflow" doc:id="4c6aaa8e-2c41-42a2-97a7-0280f168709e" name="impl-subscription-put-audit-subflow" />
			<flow-ref doc:name="impl-subscription-post-sms-subflow" doc:id="a17a479a-73fd-4ddf-9ac6-cb7569b9d02c" name="impl-subscription-post-sms-subflow" />
			<ee:transform doc:name="Set Payload - http connectivity" doc:id="e8ff00c8-4af6-4c14-b95e-c654505cb6b5">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "x-event-code": correlationId,	
  "x-event-code": 9200,
  "x-event-msg": "Connectivity Error.",
  "result": {
    "error-type": error.errorType.namespace ++ ":" ++ error.errorType.identifier,
    "error-description": error.detailedDescription
  }
}
]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<set-variable value="500" doc:name="httpStatus" doc:id="1b79d4d6-aa71-4225-aee2-23a78a648ca0" variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="b2797cb4-29c7-45ad-be4d-60ecd3727179" type="ANY">
			<flow-ref doc:name="common-set-error-audit-log-subflow"
				doc:id="f526b026-fc00-4528-9850-06d8d774c8fb"
				name="common-set-error-audit-log-subflow" />
			<flow-ref doc:name="impl-subscription-put-audit-subflow"
				doc:id="48baded3-34d2-40c6-a5cb-5fb459c00e26"
				name="impl-subscription-put-audit-subflow" />
			<flow-ref doc:name="impl-subscription-post-sms-subflow"
				doc:id="e849949e-9b61-4a02-a3c8-41862913a32b"
				name="impl-subscription-post-sms-subflow" />
			<ee:transform doc:name="Set Payload - any"
				doc:id="b1a08c09-06a0-455a-91d9-c9fb3c0f94b0">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "x-event-code": correlationId,	
  "x-event-code": 9201,
  "x-event-msg": "We encountered a system issue while processing your request. Please try again later.",
  "result": {
    "error-type": error.errorType.namespace ++ ":" ++ error.errorType.identifier,
    "error-description": error.detailedDescription
  }
}
]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<set-variable value="500" doc:name="httpStatus"
				doc:id="8a11fba4-95bf-406f-bdae-c5ad6c679147"
				variableName="httpStatus" />
		</on-error-propagate>
	</error-handler>


	<error-handler
		name="proc-subscription-api_APIKIT_Error_Handler">

		<on-error-propagate type="APIKIT:BAD_REQUEST">
			<ee:transform doc:name="Set Payload - Bad Request">
				<ee:message>
					<ee:set-payload resource="dw/api-bad-request.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="400"
				doc:name="Set httpStatus  = 400" />
		</on-error-propagate>

		<on-error-propagate type="APIKIT:NOT_FOUND">
			<ee:transform doc:name="Set Payload - Not Found">
				<ee:message>
					<ee:set-payload resource="dw/api-not-found.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="404"
				doc:name="Set httpStatus  = 404" />
		</on-error-propagate>

		<on-error-propagate
			type="APIKIT:METHOD_NOT_ALLOWED">
			<ee:transform
				doc:name="Set Payload - Method Not Allowed">
				<ee:message>
					<ee:set-payload
						resource="dw/api-method-not-allowed.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="405"
				doc:name="Set httpStatus  = 405" />
		</on-error-propagate>

		<on-error-propagate type="APIKIT:NOT_ACCEPTABLE">
			<ee:transform doc:name="Set  Payload - Not Acceptable">
				<ee:message>
					<ee:set-payload resource="dw/api-not-acceptable.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="406"
				doc:name="Set httpStatus  = 406" />
		</on-error-propagate>

		<on-error-propagate
			type="APIKIT:UNSUPPORTED_MEDIA_TYPE">
			<ee:transform
				doc:name="Set Payload - Unsupported Media Type">
				<ee:message>
					<ee:set-payload
						resource="dw/api-unsupported-media-type.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="415"
				doc:name="Set httpStatus  = 415" />
		</on-error-propagate>

		<on-error-propagate type="APIKIT:NOT_IMPLEMENTED">
			<ee:transform doc:name="Set Payload - Not Implemented">
				<ee:message>
					<ee:set-payload
						resource="dw/api-not-implemented.dwl" />
				</ee:message>
			</ee:transform>
			<set-variable variableName="httpStatus" value="501"
				doc:name="Set httpStatus  = 501" />
		</on-error-propagate>

	</error-handler>
</mule>
